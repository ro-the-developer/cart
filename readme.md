# Тестовое задание
- [test_dev.php](test_dev.php): исходный код
- [refactored.php](refactored.php): Чистый рефакторинг без нарушения публичного контракта
- [redesigned.php](redesigned.php): Переработка кода с сохранением бизнес-логики, но нарушением публичного контракта
- [test/refactoring.php](test/refactoring.php): рабочий тест рефакторинга
- [test/redesign.php](test/redesign.php): рабочий тест редизайна

Код протестирован под версиями РНР 7.4 и 8.2
В тестах вызываются Методы `calcVat()`, `makeOrder()` `notify()` и `Order::getPrice()`.

### Рефакторинг
Производился исходя из предположения, что код априори считается рабочим и нуждается только в рефакторинге. 
То есть это не сферический код в вакууме, а часть работающей системы, к правкам которой следует подходить с осторожностью.

Произведенные изменения:
- Исправил неинформативные имена переменных
- Убрал "магические числа", настройки берутся из глобального конфига
- Поправил сигнатуру метода `Cart::makeOrder()`
- Добавил декларации типов
- Вынес подсчет суммы заказа в отдельный метод
- Добавил TODO с вопросом о корректности вычисления суммы.

Вывод тестового скрипта:
```
НДС: 54
Cart::makeOrder(): string(19) "<p><b>1</b> 354</p>"
Сумма: 177
```

### Редизайн
Я позволил себе поменять публичный контракт, плюс пофантазировать над ТЗ, 
в котором, в частности, используется две функции notify:
-одна информирует о наличи корзины, которая не оформлена в виде заказа (и сумма в ней считается без учета скидки)
-а вторая информирует о создании заказа (и в ней передается актуальная сумма заказа)

Произведенные изменения:
- добавил декларации типов
- сделал массив товаров в корзине приватным
- поменял поведение метода `Cart::makeOrder()`, который возвращает созданный заказ, а не присваивает его свойству класса
- добавил в интерфейс метод `add()`
- Добавил сущность Клиент, из которой берется тип НДС, поскольку ставка может быть различной для разных типов клиентов
- реализовал метод `Cart::notify()`, который сообщает об имеющихся в корзине товарах и их общей ценой без скидки
- реализовал метод `Order::notify()`, который сообщает об оформленном заказе с указанием суммы к оплате
- сделал класс `SimpleMailer` зависимостью для классов `Cart` и `Order`

Вывод тестового скрипта:
```
НДС: 54
Cart::notify(): string(80) "<p>В корзине имеются товары на сумму 354 руб.</p>"
Cart::makeOrder(): string(75) "<p>Оформлен заказ № <b>1</b> на сумму 177 руб.</p>"
Сумма: 177
```